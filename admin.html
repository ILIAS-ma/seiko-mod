<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Gestion des Montres</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      body {
        background: #f8f8f8;
        font-family: "Poppins", sans-serif;
      }
      .admin-container {
        max-width: 700px;
        margin: 3rem auto;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.07);
        padding: 2rem;
      }
      h1 {
        text-align: center;
        margin-bottom: 2rem;
      }
      form {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 2rem;
      }
      form input,
      form textarea {
        flex: 1 1 45%;
        padding: 0.7rem;
        border-radius: 8px;
        border: 1px solid #ddd;
        font-size: 1rem;
      }
      form input[type="file"] {
        flex: 1 1 100%;
      }
      form button {
        padding: 0.7rem 2rem;
        border: none;
        border-radius: 8px;
        background: #181818;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
        margin-top: 1rem;
      }
      .montre-list {
        margin-top: 2rem;
      }
      .montre-item {
        display: flex;
        align-items: center;
        background: #fafafa;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        margin-bottom: 1rem;
        padding: 1rem;
        gap: 1.5rem;
      }
      .montre-item img {
        width: 70px;
        height: 70px;
        object-fit: contain;
        border-radius: 8px;
        background: #fff;
      }
      .montre-info {
        flex: 1;
      }
      .montre-actions button {
        margin-left: 0.5rem;
        padding: 0.4rem 1rem;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-weight: 500;
      }
      .edit-btn {
        background: #ffd600;
        color: #222;
      }
      .delete-btn {
        background: #ff5252;
        color: #fff;
      }
      .login-box {
        max-width: 400px;
        margin: 4rem auto;
        background: #fff;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .error {
        color: #c00;
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    <div id="loginSection" class="login-box">
      <h2>Connexion Admin</h2>
      <form id="loginForm">
        <input type="text" id="user" placeholder="Nom d'utilisateur" required />
        <input type="password" id="pass" placeholder="Mot de passe" required />
        <button type="submit">Se connecter</button>
        <div id="loginError" class="error"></div>
      </form>
    </div>
    <div id="adminSection" class="admin-container" style="display: none">
      <h1>Gestion des Best Sellers</h1>
      <form id="montreForm">
        <input type="hidden" id="editIndex" />
        <input type="text" id="nom" placeholder="Nom de la montre" required />
        <input
          type="text"
          id="description"
          placeholder="Description"
          required
        />
        <input
          type="number"
          id="prix"
          placeholder="Prix (€)"
          required
          min="0"
        />
        <input
          type="text"
          id="image"
          placeholder="URL de l'image (optionnel)"
        />
        <input type="file" id="imageFile" accept="image/*" />
        <button type="submit" id="submitBtn">Ajouter la montre</button>
        <button
          type="button"
          id="cancelEditBtn"
          style="display: none; background: #ccc; color: #222"
        >
          Annuler
        </button>
      </form>
      <div class="montre-list" id="montreList"></div>
    </div>
    <script>
      // Authentification simple
      const ADMIN_USER = "admin";
      const ADMIN_PASS = "admin";
      if (localStorage.getItem("isAdmin") === "true") showAdmin();
      document.getElementById("loginForm").onsubmit = function (e) {
        e.preventDefault();
        const user = document.getElementById("user").value;
        const pass = document.getElementById("pass").value;
        if (user === ADMIN_USER && pass === ADMIN_PASS) {
          localStorage.setItem("isAdmin", "true");
          showAdmin();
        } else {
          document.getElementById("loginError").textContent =
            "Identifiants incorrects";
        }
      };
      function showAdmin() {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("adminSection").style.display = "block";
        renderMontres();
      }
      function getMontres() {
        return JSON.parse(localStorage.getItem("bestSellers") || "[]");
      }
      function saveMontres(montres) {
        localStorage.setItem("bestSellers", JSON.stringify(montres));
      }
      function renderMontres() {
        const montres = getMontres();
        const list = document.getElementById("montreList");
        list.innerHTML = "";
        montres.forEach((montre, i) => {
          const div = document.createElement("div");
          div.className = "montre-item";
          div.innerHTML = `
            <img src="${montre.image}" alt="${montre.nom}">
            <div class="montre-info">
              <strong>${montre.nom}</strong><br>
              <span>${montre.description}</span><br>
              <span><b>${montre.prix} €</b></span>
            </div>
            <div class="montre-actions">
              <button class="edit-btn" onclick="editMontre(${i})">Modifier</button>
              <button class="delete-btn" onclick="deleteMontre(${i})">Supprimer</button>
            </div>
          `;
          list.appendChild(div);
        });
      }
      function resetForm() {
        document.getElementById("montreForm").reset();
        document.getElementById("editIndex").value = "";
        document.getElementById("submitBtn").textContent = "Ajouter la montre";
        document.getElementById("cancelEditBtn").style.display = "none";
      }
      window.editMontre = function (i) {
        const montre = getMontres()[i];
        document.getElementById("nom").value = montre.nom;
        document.getElementById("description").value = montre.description;
        document.getElementById("prix").value = montre.prix;
        document.getElementById("image").value = "";
        document.getElementById("editIndex").value = i;
        document.getElementById("submitBtn").textContent = "Modifier la montre";
        document.getElementById("cancelEditBtn").style.display = "inline-block";
      };
      window.deleteMontre = function (i) {
        if (confirm("Supprimer cette montre ?")) {
          const montres = getMontres();
          montres.splice(i, 1);
          saveMontres(montres);
          renderMontres();
          resetForm();
        }
      };
      document.getElementById("montreForm").onsubmit = function (e) {
        e.preventDefault();
        const nom = document.getElementById("nom").value.trim();
        const description = document.getElementById("description").value.trim();
        const prix = document.getElementById("prix").value.trim();
        const imageUrl = document.getElementById("image").value.trim();
        const imageFile = document.getElementById("imageFile").files[0];
        const editIndex = document.getElementById("editIndex").value;
        let montres = getMontres();
        function saveMontre(imageData) {
          if (editIndex !== "") {
            montres[editIndex] = { nom, description, prix, image: imageData };
          } else {
            montres.push({ nom, description, prix, image: imageData });
          }
          saveMontres(montres);
          renderMontres();
          resetForm();
        }
        if (imageFile) {
          const reader = new FileReader();
          reader.onload = function (evt) {
            saveMontre(evt.target.result);
          };
          reader.readAsDataURL(imageFile);
        } else if (imageUrl) {
          saveMontre(imageUrl);
        } else if (editIndex !== "") {
          // Si édition et pas de nouvelle image, garder l'ancienne
          saveMontre(getMontres()[editIndex].image);
        } else {
          alert("Veuillez fournir une image (import ou URL)");
        }
      };
      document.getElementById("cancelEditBtn").onclick = resetForm;
    </script>
  </body>
</html>
